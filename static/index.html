<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–ò–≥—Ä—É—à–∫–∏-–ø–∞—Ä–æ–≤–æ–∑–∏–∫–∏</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 10px; }
    input, textarea, button { padding: 8px; margin: 6px 0; width: 100%; box-sizing: border-box; }
    .toy { border: 1px solid #999; padding: 12px; margin: 12px 0; border-radius: 4px; }
    .form-group { margin: 12px 0; }
    label { display: block; font-weight: bold; margin-top: 8px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .delete-btn { background: #dc3545; }
    .delete-btn:hover { background: #c82333; }
  </style>
</head>
<body>

<h2>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É—à–∫—É-–ø–∞—Ä–æ–≤–æ–∑–∏–∫</h2>
<div class="form-group">
  <label>–ù–æ–º–µ—Ä –ø–∞—Ä–æ–≤–æ–∑–∞ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)</label>
  <input type="number" id="locomotive_number" placeholder="123" min="1" />
</div>
<div class="form-group">
  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–≥–æ–Ω–æ–≤ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)</label>
  <input type="number" id="car_count" placeholder="5" min="0" value="1" />
</div>
<div class="form-group">
  <label>–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
  <input type="text" id="material" placeholder="–ü–ª–∞—Å—Ç–∏–∫, –¥–µ—Ä–µ–≤–æ –∏ —Ç.–¥." />
</div>
<div class="form-group">
  <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
  <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—É—à–∫–∏..." rows="3"></textarea>
</div>
<button onclick="createToy()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É—à–∫—É</button>

<h2>–°–ø–∏—Å–æ–∫ –∏–≥—Ä—É—à–µ–∫</h2>
<div id="list"></div>

<script>
async function loadToys() {
  const res = await fetch('/api');
  const toys = await res.json();
  const list = document.getElementById('list');
  if (toys.length === 0) {
    list.innerHTML = '<p>–ù–µ—Ç –∏–≥—Ä—É—à–µ–∫</p>';
    return;
  }
  list.innerHTML = toys.map(t => `
    <div class="toy">
      <strong>–ü–∞—Ä–æ–≤–æ–∑ ‚Ññ${t.locomotive_number}</strong> (ID: ${t.id})<br>
      –í–∞–≥–æ–Ω–æ–≤: ${t.car_count}<br>
      –ú–∞—Ç–µ—Ä–∏–∞–ª: ${t.material || '‚Äî'}<br>
      –û–ø–∏—Å–∞–Ω–∏–µ: ${t.description || '‚Äî'}<br>
      <button onclick="editToy(${t.id})">‚úé –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="delete-btn" onclick="deleteToy(${t.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
    </div>
  `).join('');
}

async function createToy() {
  const loco = document.getElementById('locomotive_number').value;
  const cars = document.getElementById('car_count').value;
  const mat = document.getElementById('material').value.trim();
  const desc = document.getElementById('description').value.trim();

  if (!loco || !cars || !mat) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return;
  }

  await fetch('/api/create', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      locomotive_number: parseInt(loco),
      car_count: parseInt(cars),
      material: mat,
      description: desc
    })
  });

  document.getElementById('locomotive_number').value = '';
  document.getElementById('car_count').value = '1';
  document.getElementById('material').value = '';
  document.getElementById('description').value = '';
  loadToys();
}

async function deleteToy(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É—à–∫—É? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
  await fetch(`/api/delete/${id}`, { method: 'POST' });
  loadToys();
}

async function editToy(id) {
  const res = await fetch(`/api/get/${id}`);
  const t = await res.json();
  if (t.error) return alert('–ò–≥—Ä—É—à–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

  const loco = prompt('–ù–æ–º–µ—Ä –ø–∞—Ä–æ–≤–æ–∑–∞', t.locomotive_number);
  if (loco === null || loco === '') return;
  const cars = prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–≥–æ–Ω–æ–≤', t.car_count);
  if (cars === null || cars === '') return;
  const mat = prompt('–ú–∞—Ç–µ—Ä–∏–∞–ª', t.material);
  if (mat === null) return;
  const desc = prompt('–û–ø–∏—Å–∞–Ω–∏–µ', t.description || '');

  await fetch(`/api/update/${id}`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      locomotive_number: parseInt(loco),
      car_count: parseInt(cars),
      material: mat,
      description: desc
    })
  });
  loadToys();
}

loadToys();
</script>

</body>
</html>